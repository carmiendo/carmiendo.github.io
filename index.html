<!doctype html>
<html>
  <head>
    <title>Did my pony get wet?</title>

    <script src="https://cdn.tailwindcss.com"></script>

    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png" />
    <link rel="manifest" href="/site.webmanifest" />

    <!-- Sets the status bar color to black -->
    <meta name="theme-color" content="#06b6d4" />
  </head>

  <body class="bg-cyan-600">
    <div class="flex justify-center min-h-screen">
      <div class="m-20 text-center">
        <div id="answer-group">
          <p id="did-it-rain" class="text-9xl font-bold"></p>
          <p id="how-much" class="text-5xl font-bold mt-2"></p>
          <div id="prediction-group" class="m-10">
            <p id="rain-soon" class="text-7xl font-bold"></p>
            <p id="how-much-upcoming" class="text-5xl font-bold mt-2"></p>
          </div>
        </div>

        <div id="error-group">
          <p id="error" class="text-5xl italic mt-2"></p>
          <p id="error-details" class="text-xl italic mt-2"></p>
        </div>

        <button
          class="bg-pink-700 text-black text-5xl font-semibold py-3 px-6 rounded-lg shadow-xl hover:bg-pink-600 focus:outline-none focus:ring-2 focus:pink-400"
          onclick="openWeatherApp()"
        >
          Check Weather
        </button>
      </div>
    </div>

    <script>
      fetch(
        "https://api.open-meteo.com/v1/forecast?latitude=37.477871&longitude=-122.420851&daily=precipitation_sum,precipitation_hours,precipitation_probability_max&temperature_unit=fahrenheit&wind_speed_unit=mph&precipitation_unit=inch&timezone=America%2FLos_Angeles&past_days=1&forecast_days=1",
      )
        .then((response) => response.json())
        .then((data) => {
          document.getElementById("answer-group").style.display = "block";
          document.getElementById("error-group").style.display = "none";

          // day 0 is the first day
          const pastPrecipitation = data.daily.precipitation_sum[0];
          const futurePrecipitation = data.daily.precipitation_sum[1];

          // Check if it rained
          if (pastPrecipitation > 0) {
            document.getElementById("did-it-rain").textContent = `Yes!`;
            document.getElementById("how-much").textContent =
              `${pastPrecipitation} inches of rain!`;
          } else {
            document.getElementById("did-it-rain").textContent = `Nope!`;
            document.getElementById("how-much").textContent = ``;
          }

          // Check if it's going to rain'
          if (futurePrecipitation > 0) {
            document.getElementById("prediction-group").style.display = "block";

            if (pastPrecipitation > 0) {
              document.getElementById("rain-soon").textContent =
                `And more is coming:`;
            } else {
              document.getElementById("rain-soon").textContent =
                `But she will soon:`;
            }
            document.getElementById("how-much-upcoming").textContent =
              `${futurePrecipitation} inches of rain!`;
          } else {
            document.getElementById("rain-soon").textContent =
              `And she will stay dry today too!`;
            document.getElementById("how-much-upcoming").textContent = ``;
          }
        })
        .catch((error) => {
          console.error("Error fetching data:", error);

          document.getElementById("answer-group").style.display = "none";
          document.getElementById("error-group").style.display = "block";

          document.getElementById("error").textContent =
            `I don't know! Something went wrong.`;
          document.getElementById("error-details").textContent = `${error}`;
        });

      function openWeatherApp() {
        if (/iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream) {
          window.open(
            `https://weather.apple.com/?lat=37.477871&long-122.420851`,
            "_self",
          );
        } else {
          window.open(
            `https://www.wunderground.com/weather/us/ca/half-moon-bay`,
            "_self",
          );
        }
      }
    </script>
  </body>
</html>
